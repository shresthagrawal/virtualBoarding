<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>SB Admin - Dashboard</title>

  <!-- Custom fonts for this template-->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

  <!-- Page level plugin CSS-->
  <link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">

  <!-- Custom styles for this template-->
  <link href="css/sb-admin.css" rel="stylesheet">

</head>

<body id="page-top">

  <nav class="navbar navbar-expand navbar-dark bg-dark static-top">

    <a class="navbar-brand mr-1" href="index.html">Airport Management Portal </a>

    <button class="btn btn-link btn-sm text-white order-1 order-sm-0" id="sidebarToggle" href="#">
      <i class="fas fa-bars"></i>
    </button>

    <!-- Navbar Search -->
    <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2">
        <div class="input-group-append">
          <button class="btn btn-primary" type="button">
            <i class="fas fa-search"></i>
          </button>
        </div>
      </div>
    </form>

    <!-- Navbar -->
    <ul class="navbar-nav ml-auto ml-md-0">
      <li class="nav-item dropdown no-arrow mx-1">
        <a class="nav-link dropdown-toggle" href="#" id="alertsDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-bell fa-fw"></i>
          <span class="badge badge-danger">9+</span>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      <li class="nav-item dropdown no-arrow mx-1">
        <a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-envelope fa-fw"></i>
          <span class="badge badge-danger">7</span>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="messagesDropdown">
          <a class="dropdown-item" href="#">Action</a>
          <a class="dropdown-item" href="#">Another action</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#">Something else here</a>
        </div>
      </li>
      <li class="nav-item dropdown no-arrow">
        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-user-circle fa-fw"></i>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
          <a class="dropdown-item" href="#">Settings</a>
          <a class="dropdown-item" href="#">Activity Log</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#" data-toggle="modal" data-target="#logoutModal">Logout</a>
        </div>
      </li>
    </ul>

  </nav>

  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="sidebar navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="index.html">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>
      </li>
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="pagesDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          <i class="fas fa-fw fa-folder"></i>
          <span>Pages</span>
        </a>
        <div class="dropdown-menu" aria-labelledby="pagesDropdown">
          <h6 class="dropdown-header">Login Screens:</h6>
          <a class="dropdown-item" href="login.html">Login</a>
          <a class="dropdown-item" href="register.html">Register</a>
          <a class="dropdown-item" href="forgot-password.html">Forgot Password</a>
          <div class="dropdown-divider"></div>
          <h6 class="dropdown-header">Other Pages:</h6>
          <a class="dropdown-item" href="404.html">404 Page</a>
          <a class="dropdown-item" href="blank.html">Blank Page</a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="charts.html">
          <i class="fas fa-fw fa-chart-area"></i>
          <span>Data analysis</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="tables.html">
          <i class="fas fa-fw fa-table"></i>
          <span>Tables</span></a>
      </li>
    </ul>

    <div id="content-wrapper">

      <div class="container-fluid">

        <!-- Breadcrumbs-->
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <a href="#">Dashboard</a>
          </li>
          <li class="breadcrumb-item active">Overview</li>
        </ol>

        <!-- Icon Cards-->
        <div class="row">
          <div class="col-xl-3 col-sm-6 mb-3">
            <div class="card text-white bg-primary o-hidden h-100">
              <div class="card-body">
                <div class="card-body-icon">
                  <i class="fas fa-fw fa-comments"></i>
                </div>
                <div class="mr-5">Chatbot Configuration</div>
              </div>
              <a class="card-footer text-white clearfix small z-1" href="#">
                <span class="float-left">View Details</span>
                <span class="float-right">
                  <i class="fas fa-angle-right"></i>
                </span>
              </a>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 mb-3">
            <div class="card text-white bg-warning o-hidden h-100">
              <div class="card-body">
                <div class="card-body-icon">
                  <i class="fas fa-fw fa-list"></i>
                </div>
                <div class="mr-5">Beacon Configuration</div>
              </div>
              <a class="card-footer text-white clearfix small z-1" href="#">
                <span class="float-left">View Details</span>
                <span class="float-right">
                  <i class="fas fa-angle-right"></i>
                </span>
              </a>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 mb-3">
            <div class="card text-white bg-success o-hidden h-100">
              <div class="card-body">
                <div class="card-body-icon">
                  <i class="fas fa-fw fa-shopping-cart"></i>
                </div>
                <div class="mr-5">Customer Surveys</div>
              </div>
              <a class="card-footer text-white clearfix small z-1" href="#">
                <span class="float-left">View Details</span>
                <span class="float-right">
                  <i class="fas fa-angle-right"></i>
                </span>
              </a>
            </div>
          </div>
          <div class="col-xl-3 col-sm-6 mb-3">
            <div class="card text-white bg-danger o-hidden h-100">
              <div class="card-body">
                <div class="card-body-icon">
                  <i class="fas fa-fw fa-life-ring"></i>
                </div>
                <div class="mr-5">Management</div>
              </div>
              <a class="card-footer text-white clearfix small z-1" href="#">
                <span class="float-left">View Details</span>
                <span class="float-right">
                  <i class="fas fa-angle-right"></i>
                </span>
              </a>
            </div>
          </div>
        </div>

        <div style="position: relative; display: block; margin-bottom: 20px;" id="canvasContainer">
          <canvas id="canvas" width="1000px" height="500px" style=" display: block;" id="canvas">
          </canvas>
          <img src="./poi/eat.png" oncontextmenu="removeElement(event)" class="draggable first drag1" style="float: left;position: absolute; top: 25px; left: 1050px;"></img><span style="font-size: 20px; position: absolute; left: 1150px; top: 35px;">Add a restaurant</span>
          <img src="./poi/gate.png" oncontextmenu="removeElement(event)" class="draggable first drag2" style="position: absolute; top: 135px; left: 1050px;"></img><span style="font-size: 20px; position: absolute; left: 1150px; top: 160px;">Add a gate</span>
          <img src="./poi/toilet.png" oncontextmenu="removeElement(event)" class="draggable first drag3" style="position: absolute; top: 245px; left: 1050px;"></img><span style="font-size: 20px; position: absolute; left: 1150px; top: 280px;">Add a toilet</span>
          <img src="./poi/bus.png" oncontextmenu="removeElement(event)" class="draggable first drag4" style="position: absolute; top: 360px; left: 1050px;"></img><span style="font-size: 20px; position: absolute; left: 1150px; top: 390px;">Add a car sharing point</span>

        </div>

        <!-- Area Chart Example-->
        <div class="card mb-3">
          <div class="card-header">
            <i class="fas fa-chart-area"></i>
            Airport visitors last week</div>
          <div class="card-body">
            <canvas id="myAreaChart" width="100%" height="30"></canvas>
          </div>
          <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
        </div>

        <!-- DataTables Example -->
        <div class="card mb-3">
          <div class="card-header">
            <i class="fas fa-table"></i>
            Flights Overview</div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                <thead>
                  <tr>
                    <th>Flightnumber</th>
                    <th>Terminal</th>
                    <th>Destination</th>
                    <th>Airline</th>
                    <th>Gate</th>
                  </tr>
                </thead>
                <tfoot>
                  <tr>
                    <th>Flightnumber</th>
                    <th>Terminal</th>
                    <th>Destination</th>
                    <th>Airline</th>
                    <th>Gate</th>
                  </tr>
                </tfoot>
                <tbody id="tableBody">
                 
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer small text-muted">Updated yesterday at 11:59 PM</div>
        </div>

      </div>
      <!-- /.container-fluid -->

      <!-- Sticky Footer -->
      <footer class="sticky-footer">
        <div class="container my-auto">
          <div class="copyright text-center my-auto">
            <span>Copyright © Your Website 2019</span>
          </div>
        </div>
      </footer>

    </div>
    <!-- /.content-wrapper -->

  </div>
  <!-- /#wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Logout Modal-->
  <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
          <button class="close" type="button" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">×</span>
          </button>
        </div>
        <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
          <a class="btn btn-primary" href="login.html">Logout</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap core JavaScript-->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Core plugin JavaScript-->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Page level plugin JavaScript-->
  <script src="vendor/chart.js/Chart.min.js"></script>
  <script src="vendor/datatables/jquery.dataTables.js"></script>
  <script src="vendor/datatables/dataTables.bootstrap4.js"></script>

  <!-- Custom scripts for all pages-->
  <script src="js/sb-admin.min.js"></script>

  <!-- Demo scripts for this page-->
  <script src="js/demo/datatables-demo.js"></script>
  <script src="js/demo/chart-area-demo.js"></script>

   <!-- Bootstrap core JavaScript -->
   
   <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
   <!-- Menu Toggle Script -->
   <script>
     const canvas = document.getElementById("canvas");
     const canvasWidth = getComputedStyle(canvas).width.substr(0, getComputedStyle(canvas).width.length - 2)
     const canvasHeight = getComputedStyle(canvas).height.substr(0, getComputedStyle(canvas).height.length - 2)
     var ctx = canvas.getContext("2d");
     ctx.width = canvasWidth;
     ctx.height = canvasHeight;
     
     $("#menu-toggle").click(function(e) {
       e.preventDefault();
       $("#wrapper").toggleClass("toggled");
     });
 
 
     var background = new Image();
     background.src = "./background.svg";
     
     background.onload = function() {
       
       ctx.drawImage(background, 0, 0, 1010, 505,     // source rectangle
                    0, 0, canvasWidth, canvasHeight);
     }
   
 
    function calculateMinMax(series) {
      let minArr = [0, 0]
      for(let i= 0; i< series.length; i++) {
        if(series[i][0] > minArr[0]) {
          minArr[0] = series[i][0];
        }
        if(series[i][1] > minArr[1]) {
          minArr[1] = series[i][1];
        }
      }
      return minArr
    }

    $.get("http://40.68.184.28:8005/securityGate", function(data) {
      const arr = JSON.parse(data);
      const sc1Open = arr[0]["Status"] !== "closed"
      const sc1Waittime = +arr[0]["WaitTime"]
      const sc2Open = arr[1]["Status"]
      const sc2Waittime = +arr[1]["WaitTime"]
      const sc1Text = document.createElement("div");
      sc1Text.innerHTML = `<font color='${sc1Open ? "green" : "red"}'>${sc1Open ? "Opened - " : "Closed"}</font>${sc1Open ? sc1Waittime + "m waiting" : ""}`;
      sc1Text.style.position = "absolute";
      sc1Text.style.top = "80px";
      sc1Text.style.left = "240px";
      document.getElementById("canvasContainer").appendChild(sc1Text);
      const sc2Text = sc1Text.cloneNode(true);
      sc2Text.style.top = "475px"
      sc2Text.innerHTML = `<font color='${sc2Open ? "green" : "red"}'>${sc2Open ? "Opened - " : "Closed"}</font>${sc2Open ? sc2Waittime + "m waiting" : ""}`;
      document.getElementById("canvasContainer").appendChild(sc2Text);


    });

     const p = $.get("http://40.68.184.28:8005/getPosition", function(data) {
      
      let coordArray = JSON.parse(data);
      //coordArray.splice(0, coordArray.length - 30)
      
      //console.log(data)
      //const coordArray = [[0.48085630073970814, 1.5562280580701313], [0.48085630073970814, 1.6417413434644441], [0.48269035567796464, 1.6577201335438343], [0.32701407336226584, 1.4472605832410324], [0.3152729359527062, 1.1015424069043886], [0.4906382459169339, 1.2283628772846449], [0.4906382459169339, 1.3133564042887331], [1.0293465845459666, 1.2780176142032382], [1.0876100087279807, 1.9873826935349581], [1.0876100087279807, 1.8812485666679675], [1.1054481700912588, 1.500711196533617], [1.3714164380465608, 1.5196170025835172], [1.4467648889982927, 1.6962063613911709], [1.7139452204280772, 1.8379786780962886], [2.2382449270128104, 2.4216276189965846], [3.2183324161329416, 2.750277152422904], [5.006339447751212, 2.561331379971744], [5.180618399958033, 2.561331379971744], [5.307171841209213, 2.7345665090966365], [5.421734370566339, 2.7345665090966365], [5.389116739574494, 2.6209968795375773], [5.185433296800479, 2.64619406347466], [4.902015549535463, 3.206378628570072], [4.188739367994692, 3.1790365534819727], [3.8778929540847216, 3.1301157937289212], [2.8553449587269673, 3.0328100636413695], [1.8675424799044484, 2.8825253936415187], [2.788343619801755, 2.624393890344797], [3.101292924138819, 2.3204070015682947], [3.286463343945794, 1.8803841414608296], [3.84917435932293, 1.8803841414608296], [4.410161418293694, 1.8803841414608296], [4.2467755325797825, 1.3356129960115253], [5.051314379932357, 1.044044895186971], [5.565566449895241, 1.162013170002807], [4.98053638444227, 0.4588667813241394], [4.296347518744328, 0.3589056710483968], [3.7195861052270534, 0.30287023846796735], [3.6172041383564064, 0.42958202916383553], [3.3034680169938255, 0.4033100239287489], [3.0878095251664774, 0.48104860769054153], [2.7972609734757365, 0.5186809873462266], [2.4640255154066035, 0.5413916573397639], [2.310736955505372, 0.5453804761996335], [2.2497938272774634, 0.554316745489272]]
      
      const height = 4
      const width = 6
      

      const widthFactor = canvasWidth / width
      const heightFactor = canvasHeight / height
      
    

      for(let i = 0; i < coordArray.length - 1; i++) {
        ctx.beginPath();
        ctx.strokeStyle = "#FF0000";
        ctx.lineWidth = 3;
        /*let constAverage = (coordArray[i][1] + coordArray[i + 1][1]) / 2;
        if(constAverage < coordArray[i][1] * 0.94 || constAverage > coordArray[i][1] * 1.06) {
          console.log(coordArray[i])
          
         // ctx.arc(coordArray[i][0] * heightFactor, coordArray[i][1] * widthFactor, 8, 0, 2 * Math.PI);
          ctx.fillStyle = "#Ff0000";
          ctx.fill();
        }*/
        ctx.moveTo(coordArray[i][0] * widthFactor, coordArray[i][1] * heightFactor);
        ctx.lineTo(coordArray[i+1][0] * widthFactor, coordArray[i+1][1] * heightFactor);
        //console.log(coordArray[i+1][0] * heightFactor, coordArray[i+1][1] * widthFactor)
        ctx.stroke();
      }

      
      
     // console.log(data);
     });
 
     function getDragClass(item) {
       if (item.classList.contains("drag1")) {
         return "drag1";
       }
       if (item.classList.contains("drag2")) {
         return "drag2";
       }
       if (item.classList.contains("drag3")) {
         return "drag3";
       }
       if (item.classList.contains("drag4")) {
         return "drag4";
       }
       return "drag?"
     }

     const draggables = [...document.getElementsByClassName("draggable")];
     for(let j = 0; j < draggables.length; j++) {
       let x = draggables[j];
       if(window.localStorage.getItem(getDragClass(x))) {
         let arr = JSON.parse(window.localStorage.getItem(getDragClass(x))) || [];
         for(let i = 0; i < arr.length; i++) {
           let newNode = x.cloneNode(true);
           newNode.style.left = arr[i][0] + "px";
           
           newNode.style.top = arr[i][1] + "px";
           
           
           document.getElementById("canvasContainer").appendChild(newNode);
           newNode.classList.remove("first");
         }
       }
     }
     
     
     $( function() {
       const draggableObj = {
         containment: "parent",
         start: function (event, ui ) {
          if(!event.target.classList.contains("first")) {
            event.target.style.transform = "translateY(-15%)"
          }
           if (event.target.classList.contains("first")) {
             const newNode = event.target.cloneNode(true);
             newNode.style.left = Math.round(+event.target.style.left);
             newNode.style.top = Math.round(+event.target.style.top);
             event.target.classList.remove("first");
             
             
             document.getElementById("canvasContainer").appendChild(newNode)
             $( ".draggable" ).draggable(draggableObj);
 
             
             
           } else {
             let newObj = JSON.parse(window.localStorage.getItem(getDragClass(event.target)));
             let left = event.target.style.left.substr(0, event.target.style.left.length - 2)
             let top = event.target.style.top.substr(0, event.target.style.top.length - 2)
             
             removeItem(newObj, [Math.round(+left), Math.round(+top)])
             window.localStorage.setItem(getDragClass(event.target), JSON.stringify(newObj));
           }
         
         },
         stop: function( event, ui ) {
            if(!event.target.classList.contains("first")) {
                event.target.style.transform = "translateY(0%)"
            }
           //let posX = event.target.offsetLeft
           //let posY = event.target.offsetTop
           let posX = +event.target.style.left.substr(0, event.target.style.left.length - 2)
           let posY = +event.target.style.top.substr(0, event.target.style.top.length - 2)
           let elemNo = +getDragClass(event.target).substr(4, 1);
           console.log(elemNo);
           if (posX > 1000) {
             document.getElementById("canvasContainer").removeChild(event.target);
             $.get(`http://40.68.184.28:8005/poiDelete?poi=[${elemNo},${posX + 80},${posY + 30}]`);
             removeElement(event)
             return;
           }
           let setValue = window.localStorage.getItem(getDragClass(event.target));
           $.get(`http://40.68.184.28:8005/poiAdd?poi=[${elemNo},${posX + 80},${posY + 30}]`);
           if(setValue) {
             let obj = JSON.parse(setValue);
             obj.push([Math.round(posX), Math.round(posY)]);
             window.localStorage.setItem(getDragClass(event.target), JSON.stringify(obj))  
           } else {
             window.localStorage.setItem(getDragClass(event.target), `[[${Math.round(posX)}, ${Math.round(posY)}]]`)
           }
         }
       };
       $( ".draggable" ).draggable(draggableObj);
     } );
     
     function removeElement(event) {
       event.preventDefault();
       if(event.target.classList.contains("first")) {
         return;
       }
       document.getElementById('canvasContainer').removeChild(event.target);
       let newObj = JSON.parse(window.localStorage.getItem(getDragClass(event.target)));
       let left = event.target.style.left.substr(0, event.target.style.left.length - 2)
       let top = event.target.style.top.substr(0, event.target.style.top.length - 2)
       let elemNo = +getDragClass(event.target).substr(4, 1);
       $.get(`http://40.68.184.28:8005/poiDelete?poi=[${elemNo},${Math.round(+left) + 80},${Math.round(+top) + 30}]`);
       removeItem(newObj, [Math.round(+left), Math.round(+top)])
       
       window.localStorage.setItem(getDragClass(event.target), JSON.stringify(newObj));
 
     }
 
     function removeItem(newObj, item) {
      
       for(let i= 0; i < newObj.length; i++) {
         let array1 = newObj[i]
         let array2 = item
         
         if(array1.length === array2.length && array1.sort().every(function(value, index) { return Math.round(value) === Math.round(array2.sort()[index])})) {
           console.log("found")
           newObj.splice(i, 1);
         }
       }
     }
   </script>
    <script>
        $.get("http://40.68.184.28:8005/flightData", function(data) {
          let all = JSON.parse(data);
          for (let i = 0; i < all.length; i++) {
            let obj = all[i];
            let trel = document.createElement("tr");

            let flightNumber = obj["Flight"]["Number"];
            let terminal = obj["Terminal"]
            let destination = obj["Destination"]["Name"]
            let airline = obj["Airline"]
            let gate = obj["Gate"]
            
            let flightNumbertd = document.createElement("td");
            let terminaltd = document.createElement("td");
            let destinationtd = document.createElement("td");
            let airlinetd = document.createElement("td");
            let gatetd = document.createElement("td");

            flightNumbertd.innerText = flightNumber;
            terminaltd.innerText = terminal;
            destinationtd.innerText = destination;
            airlinetd.innerText = airline;
            gatetd.innerText = gate;

            trel.appendChild(flightNumbertd);
            trel.appendChild(terminaltd);
            trel.appendChild(destinationtd);
            trel.appendChild(airlinetd);
            trel.appendChild(gatetd);

            document.getElementById("tableBody").appendChild(trel);
          }
        });
      </script>
     <style>
       @keyframes slideInFromLeft {
  0% {
    transform: translateY(-30%);
  }
  100% {
    transform: translateY(0);
  }
}
@keyframes opacitya {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.draggable {
  cursor: pointer;
  width: 60px;
  height: 80px;
  animation: slideInFromLeft 0.5s;
  transition: transform 0.5s;
}
#canvas {
  animation: opacitya 1s;
}


     
      </style>
 

</body>

</html>
